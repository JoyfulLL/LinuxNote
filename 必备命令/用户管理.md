# 用户管理

## 概述

1）概述

- Linux系统是一个多用户系统
- 大部分操作需要使用root实现，普通用户只在/home/username和/tmp下有权限
- 推荐使用普通用户，提升系统安全性

2）UID，GID

- UID user id，身份证号码
- GID group id 户口本号码

3）用户分类

| 用户分类 | 依据UID分类                                          |
| -------- | ---------------------------------------------------- |
| root     | UID为0                                               |
| 普通用户 | UID>1000                                             |
| 虚拟用户 | UID<1000，用户服务，进程运行使用的用户，无法直接使用 |



## 用户相关的文件

> Linux下，每创建一个用户，一般会影响下列的几个文件

| 用户相关文件    | 说明               |
| --------------- | ------------------ |
| **/etc/passwd** | 存放用户信息       |
| /etc/shadow     | 存放密码信息       |
| /etc/group      | 存放用户组信息     |
| /etc/gshadow    | 存放用户组密码信息 |

### **/etc/passwd**文件详解:meat_on_bone::meat_on_bone::meat_on_bone::meat_on_bone::meat_on_bone:

```shell
[root@manager ~]# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
abig:x:1001:1001::/home/abig:/bin/bash

Description：
Username:Password:UID:GID:User ID Info:Home directory:Command/shell

Password：An x character indicates that encrypted and salted password is stored in /etc/shadow file. Please note that you need to use the passwd command to computes the hash of a password typed at the CLI or to store/update the hash of the password in /etc/shadow file.

Command/shell: 判断是否为虚拟用户，如果是/sbin/nologin，则为虚拟用户；/bin/bash则为正常的普通用户
```

### /etc/shadow

第一列为用户名

第二列为密码

第三列为密码过期时间，默认不过期

```shell
[root@manager ~]# cat /etc/shadow
root:$6$Fope4aT.r2XTeFJmycn11::0:99999:7:::
bin:*:18353:0:99999:7:::
abig:!!:19854:0:99999:7:::
```



## <u>用户管理指令</u>:meat_on_bone::meat_on_bone::meat_on_bone::meat_on_bone::meat_on_bone:

- 增加useradd
- 删除userdel
- 修改usermod
- 查找



### 添加用户

选项解释

- -u 指定 UID
- -s 指定命令解释器，默认为/bin/bash
- -M 不创建用户的家目录

```shell
[root@manager ~]# useradd test -u 1314 -s /sbin/nologin -M
添加完毕后，查看文件
[root@manager ~]# grep 'test' /etc/passwd  /etc/shadow  /etc/group
/etc/passwd:test:x:1314:1314::/home/test:/sbin/nologin
/etc/shadow:test:!!:19854:0:99999:7:::
/etc/group:test:x:1314:

没有创建家目录
[root@manager ~]# ll /home/test
ls: cannot access /home/test: No such file or directory

查看用户
[root@manager ~]# id test
uid=1314(test) gid=1314(test) groups=1314(test)
```

为用户添加密码

```shell
交互式
[root@manager ~]# passwd test
Changing password for user test.
New password:
BAD PASSWORD: The password is a palindrome
Retype new password:
passwd: all authentication tokens updated successfully.

非交互式修改密码，用于批量修改，仅root能用
[root@manager ~]# echo 1 | passwd --stdin test
Changing password for user test.
passwd: all authentication tokens updated successfully.
```

### 删除用户

> 可以通过注释的方式，让系统认为用户不存在。不一定需要使用userdel

userdel选项

- -r 删除用户的家目录 :warning:
- 默认不会删除用户的家目录

```shell
[root@manager ~]# userdel test
```

使用注释的方式，“删除”用户

```shell
[root@manager ~]# tail -n1 /etc/passwd
test:x:1002:1002::/home/test:/bin/bash
[root@manager ~]# id test
uid=1002(test) gid=1002(test) groups=1002(test)
[root@manager ~]# sed -i '/^test/s/^/#/' /etc/passwd
[root@manager ~]# tail -n1 /etc/passwd
#test:x:1002:1002::/home/test:/bin/bash
[root@manager ~]# id test
id: test: no such user
```

> 需要重新使用这个用户，去掉前面的注释即可